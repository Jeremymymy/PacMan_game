# PacMan_game
此專案為自行實作的 Pac Man 遊戲，能夠在我撰寫的網頁上遊玩經典的小遊戲 Pac Man
-------------
玩法:

使用者僅需透過鍵盤上的 W, A, S, D 按鍵即可控制小精靈去吃掉地圖上的分數點，吃完所有分數點即可獲得勝利。
地圖中有四隻鬼會進行隨機移動，若小精靈被鬼碰到則損失一條命並且返回原點，生命總共有三條，用完即失敗。
地圖中也有分布能量球，小精靈吃到能量球可以在短時間內獲得反殺鬼的能力當鬼的顏色開始閃爍，代表能量球的效力即將消失，鬼也會在一段時間後重生。
隨著分數的遞增，鬼的移動速度會變快，因此在地圖左右兩側設計能夠進行穿越的通道，讓小精靈能夠在地圖中盡情奔跑。

系統開發平台:
------------
本次專案是在Visual Studio Code的環境上進行開發，開發工具為HTML、CSS以及JavaScript，
整體遊戲畫面在canvas上繪製，並且引用套件SweetAlert來美化獲得勝利或宣告遊戲失敗時的彈跳視窗。

程式說明:
--------
此次作品包含PacMan.html、PacMan.css以及PacMan.js三個檔案，網頁中的文字說明主要撰寫於.html檔中，網頁背景的設計以及文字的樣式與排版由.css檔所編寫，遊戲主程式則由.js檔所控制，在這之中用到的圖片與音檔分別存放於img以及music的資料夾。

在PacMan.js檔案中設計了Boundary(邊界)、Player(小精靈)、Ghost(鬼)、Pellet(分數點)、PowerUp(能量球)以及Gateway(傳送門)六個classes，其中Player、Ghost、Pellet以及PowerUp的物件由canvas所繪製。

邊界由許多塊的物件組成，Boundary類別則定義了這些邊界物件的長寬，配合用list設計的地圖以及forEach迴圈定義每個邊界物件的座標，最後以圖片的方式呈現每塊邊界物件。分數點以及能量球物件的設計方法類似，分別透過Pellet類別與PowerUp類別定義其半徑，配合地圖的設計決定其座落位置，最終由成員函式draw()繪出。而傳送門物件也是透過Gateway類別以及地圖的設計完成座標定義。

Player類別與Ghost類別分別定義各自半徑，再透過成員函式draw()繪出，於初始化物件時定義各自的起始點以及初始速度，較特別的是Player與Ghost類別多了一個成員函式update()，每當畫面刷新獲得新的速度方向就會用來更改其物件的座標並呼叫draw()函式繪製，使小精靈與鬼物件在地圖中移動。

在使用者的操作上透過addEventListener('keydown', () => {})函式執行，按下規定的方向按鍵後，儲存該方向至變數以方便後續操作。

程式碼中還包含了兩個自訂的全域函式circleCollideWithRectangle()以及animation()。前者透過物件的大小、座標以及速度方向來判定小精靈或鬼將要移動的方向是否會撞上邊界，後者則是本次專案的主要函式，其運用requestAnimationFrame()不斷重複呼叫自己，使遊戲畫面能不斷刷新。我也使用了cancelAnimationFrame()、setTimeout(() => {}, )以及requestAnimationFrame()讓畫面能夠在小精靈與鬼碰撞時暫停一小段時間再繼續刷新。

在animation()函式中，根據不同的方向按鍵改變小精靈的移動方向變化量，並先透過circleCollideWithRectangle()預測該方向是否可行，若不可行則保持原移動方向前進，並且記錄下此不可行的方向。在每次刷新移動後，透過includes()、circleCollideWithRectangle()、toString()、push()、filter()函式以及各種條件判斷偵測該方向是否變成可行。此演算法讓使用者看到路口想轉彎時，可以提前按下該方向鍵，小精靈走到該路口時就會自動轉彎，使遊玩過程更加人性化。在鬼的移動方向上也是透過類似的概念判斷當下有哪些方向是可供行走的，在可行的方向中隨機挑選一個方向前進。

(補充上述演算法的原理)
每次小精靈的位置刷新之後，對每個邊界物件跑迴圈，搭配circleCollideWithRectangle()這個函數運算物件之間的距離，如果下一步想要前往的方向是邊界，就會回傳true。藉由這個函數判斷並且記錄下一步往哪個方向走會撞牆，算是預測的概念。接著跟上一步不能行走的方向做比較，找出哪些方向變成可行並且記錄。

此主要函式也包含判定鬼是否撞到小精靈，若正常狀態的鬼撞到小精靈則損失一條命，生命用完即跳出彈跳視窗宣告遊戲失敗；若處於驚嚇狀態的鬼撞到小精靈，鬼就會被吃掉並獲得分數，而鬼將在7秒後重生。此函式也有設計小精靈吃掉分數點獲得分數以及吃掉能量球使鬼短暫處於驚嚇狀態的功能，當驚嚇狀態快結束時，鬼的顏色會開始閃爍以警示使用者，若吃完全部分數點就會跳出彈跳視窗宣告勝利。上述提及小精靈撞到鬼、吃掉分數點以及能量球的判斷皆是使用Math.hypot()計算圓心之間的距離而完成。

當小精靈吃掉地圖中三成的分數點以及七成的分數點時，鬼的移動速度都會有所提升。而傳送門的設計則是更改經過傳送門的小精靈或鬼的座標，簡單的達成傳送的效果。若希望遊戲重新開始，可點按下方Restart按鈕。
